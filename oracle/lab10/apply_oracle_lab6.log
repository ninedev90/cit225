SQL> -- Set the page size.
SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Item #1. [4 points] Add the RENTAL_ITEM_PRICE and RENTAL_ITEM_TYPE columns to
SQL> -- the RENTAL_ITEM table. Both columns should use a NUMBER data type.
SQL> -- ----------------------------------------------------------------------
SQL> ALTER TABLE rental_item_lab
  2    ADD (rental_item_lab_price NUMBER)
  3    ADD (rental_item_lab_type NUMBER);

Table altered.

SQL> 
SQL> 
SQL> /* ----------------------------------------------------------------------
> -- Verification of item_lab #1.
SQL> -- Should show the table below
SQL> 
SQL> TABLE_NAME     COLUMN_ID COLUMN_NAME	     NULLABLE DATA_TYPE
SQL> -------------- --------- ---------------------- -------- ------------
SQL> RENTAL_ITEM	    1 RENTAL_ITEM_ID	     NOT NULL NUMBER(22)
SQL> RENTAL_ITEM	    2 RENTAL_ID 	     NOT NULL NUMBER(22)
SQL> RENTAL_ITEM	    3 ITEM_ID		     NOT NULL NUMBER(22)
SQL> RENTAL_ITEM	    4 CREATED_BY	     NOT NULL NUMBER(22)
SQL> RENTAL_ITEM	    5 CREATION_DATE	     NOT NULL DATE
SQL> RENTAL_ITEM	    6 LAST_UPDATED_BY	     NOT NULL NUMBER(22)
SQL> RENTAL_ITEM	    7 LAST_UPDATE_DATE	     NOT NULL DATE
SQL> RENTAL_ITEM	    8 RENTAL_ITEM_TYPE		      NUMBER(22)
SQL> RENTAL_ITEM	    9 RENTAL_ITEM_PRICE 	      NUMBER(22)
SQL> 
SQL> 9 rows selected.
SQL> */
SQL> -- ----------------------------------------------------------------------
SQL> SET NULL ''
SQL> COLUMN table_name	 FORMAT A14
SQL> COLUMN column_id	 FORMAT 9999
SQL> COLUMN column_name  FORMAT A22
SQL> COLUMN data_type	 FORMAT A12
SQL> SELECT   table_name
  2  ,	      column_id
  3  ,	      column_name
  4  ,	      CASE
  5  		WHEN nullable = 'N' THEN 'NOT NULL'
  6  		ELSE ''
  7  	      END AS nullable
  8  ,	      CASE
  9  		WHEN data_type IN ('CHAR','VARCHAR2','NUMBER') THEN
 10  		  data_type||'('||data_length||')'
 11  		ELSE
 12  		  data_type
 13  	      END AS data_type
 14  FROM     user_tab_columns
 15  WHERE    table_name = 'RENTAL_ITEM_LAB'
 16  ORDER BY 2;

                         Column                                                 
Table Name     Column ID Name                   Nullable Data Type              
-------------- --------- ---------------------- -------- ------------           
RENTAL_ITEM_LA         1 RENTAL_ITEM_LAB_ID     NOT NULL NUMBER(22)             
B                                                                               
                                                                                
RENTAL_ITEM_LA         2 RENTAL_LAB_ID          NOT NULL NUMBER(22)             
B                                                                               
                                                                                
RENTAL_ITEM_LA         3 ITEM_LAB_ID            NOT NULL NUMBER(22)             
B                                                                               
                                                                                
RENTAL_ITEM_LA         4 CREATED_BY             NOT NULL NUMBER(22)             
B                                                                               
                                                                                
RENTAL_ITEM_LA         5 CREATION_DATE          NOT NULL DATE                   
B                                                                               
                                                                                
RENTAL_ITEM_LA         6 LAST_UPDATED_BY        NOT NULL NUMBER(22)             
B                                                                               
                                                                                
RENTAL_ITEM_LA         7 LAST_UPDATE_DATE       NOT NULL DATE                   
B                                                                               
                                                                                
RENTAL_ITEM_LA         8 RENTAL_ITEM_LAB_PRICE           NUMBER(22)             
B                                                                               
                                                                                
RENTAL_ITEM_LA         9 RENTAL_ITEM_LAB_TYPE            NUMBER(22)             
B                                                                               
                                                                                

9 rows selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #2. [4 points] Create the PRICE table as per the specification qualified
SQL> -- below. The specification requires that you add a 'Y' or 'N' against the
SQL> -- ACTIVE_FLAG column. You should use YN_PRICE for the name of the CHECK
SQL> -- constraint.
SQL> -- ----------------------------------------------------------------------
SQL> 
SQL> CREATE TABLE price_lab
  2  ( price_lab_id		     NUMBER
  3    , item_lab_id		     NUMBER	   CONSTRAINT nn_price_lab_1 NOT NULL
  4    , price_type		     NUMBER
  5    , active_flag		     VARCHAR2(1)   CONSTRAINT yn_price CHECK(active_flag in ('Y', 'N'))
  6    , start_date		     DATE	   CONSTRAINT nn_price_lab_3 NOT NULL
  7    , end_date		     DATE
  8    , amount 		     NUMBER	   CONSTRAINT nn_price_lab_8 NOT NULL
  9    , created_by		     NUMBER	   CONSTRAINT nn_price_lab_4 NOT NULL
 10    , creation_date		     DATE	   CONSTRAINT nn_price_lab_5 NOT NULL
 11    , last_updated_by	     NUMBER	   CONSTRAINT nn_price_lab_6 NOT NULL
 12    , last_update_date	     DATE	   CONSTRAINT nn_price_lab_7 NOT NULL
 13    , CONSTRAINT pk_price_lab_1	PRIMARY KEY(price_lab_id)
 14    , CONSTRAINT fk_price_lab_2	FOREIGN KEY(item_lab_id)     REFERENCES item_lab(item_lab_id));

Table created.

SQL>   , CONSTRAINT fk_price_lab_3	FOREIGN KEY(price_type)      REFERENCES common_lookup_lab(common_lookup_lab_id)
SP2-0734: unknown command beginning ", CONSTRAI..." - rest of line ignored.
SQL>   , CONSTRAINT fk_price_lab_4	FOREIGN KEY(created_by)      REFERENCES system_user_lab(system_user_lab_id)
SP2-0734: unknown command beginning ", CONSTRAI..." - rest of line ignored.
SQL>   , CONSTRAINT fk_price_lab_5	FOREIGN KEY(last_updated_by) REFERENCES system_user_lab(system_user_lab_id));
SP2-0734: unknown command beginning ", CONSTRAI..." - rest of line ignored.
SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification of Step #2 - Price Lab Table
SQL> -- ----------------------------------------------------------------------
SQL> SET NULL ''
SQL> COLUMN table_name	 FORMAT A14
SQL> COLUMN column_id	 FORMAT 9999
SQL> COLUMN column_name  FORMAT A22
SQL> COLUMN data_type	 FORMAT A12
SQL> SELECT   table_name
  2  ,	      column_id
  3  ,	      column_name
  4  ,	      CASE
  5  		WHEN nullable = 'N' THEN 'NOT NULL'
  6  		ELSE ''
  7  	      END AS nullable
  8  ,	      CASE
  9  		WHEN data_type IN ('CHAR','VARCHAR2','NUMBER') THEN
 10  		  data_type||'('||data_length||')'
 11  		ELSE
 12  		  data_type
 13  	      END AS data_type
 14  FROM     user_tab_columns
 15  WHERE    table_name = 'PRICE_LAB'
 16  ORDER BY 2;

                         Column                                                 
Table Name     Column ID Name                   Nullable Data Type              
-------------- --------- ---------------------- -------- ------------           
PRICE_LAB              1 PRICE_LAB_ID           NOT NULL NUMBER(22)             
PRICE_LAB              2 ITEM_LAB_ID            NOT NULL NUMBER(22)             
PRICE_LAB              3 PRICE_TYPE                      NUMBER(22)             
PRICE_LAB              4 ACTIVE_FLAG                     VARCHAR2(1)            
PRICE_LAB              5 START_DATE             NOT NULL DATE                   
PRICE_LAB              6 END_DATE                        DATE                   
PRICE_LAB              7 AMOUNT                 NOT NULL NUMBER(22)             
PRICE_LAB              8 CREATED_BY             NOT NULL NUMBER(22)             
PRICE_LAB              9 CREATION_DATE          NOT NULL DATE                   
PRICE_LAB             10 LAST_UPDATED_BY        NOT NULL NUMBER(22)             
PRICE_LAB             11 LAST_UPDATE_DATE       NOT NULL DATE                   

11 rows selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification of Step #2 - Constraint Check
SQL> -- ----------------------------------------------------------------------
SQL> COLUMN constraint_name   FORMAT A16
SQL> COLUMN search_condition  FORMAT A30
SQL> SELECT   uc.constraint_name
  2  ,	      uc.search_condition
  3  FROM     user_constraints uc INNER JOIN user_cons_columns ucc
  4  ON       uc.table_name = ucc.table_name
  5  AND      uc.constraint_name = ucc.constraint_name
  6  WHERE    uc.table_name = UPPER('price_lab')
  7  AND      ucc.column_name = UPPER('active_flag')
  8  AND      uc.constraint_name = UPPER('yn_price')
  9  AND      uc.constraint_type = 'C';

Constraint Name  Search Condition                                               
---------------- ------------------------------                                 
YN_PRICE         active_flag in ('Y', 'N')                                      

1 row selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #3a - [2 points] Rename the ITEM_RELEASE_DATE column of the ITEM
SQL> -- table to RELEASE_DATE.
SQL> -- ----------------------------------------------------------------------
SQL> ALTER TABLE item_lab RENAME
  2  COLUMN item_lab_release_date TO release_date;

Table altered.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification Step #3a
SQL> -- ----------------------------------------------------------------------
SQL> SET NULL ''
SQL> COLUMN table_name	 FORMAT A14
SQL> COLUMN column_id	 FORMAT 9999
SQL> COLUMN column_name  FORMAT A22
SQL> COLUMN data_type	 FORMAT A12
SQL> SELECT   table_name
  2  ,	      column_id
  3  ,	      column_name
  4  ,	      CASE
  5  		WHEN nullable = 'N' THEN 'NOT NULL'
  6  		ELSE ''
  7  	      END AS nullable
  8  ,	      CASE
  9  		WHEN data_type IN ('CHAR','VARCHAR2','NUMBER') THEN
 10  		  data_type||'('||data_length||')'
 11  		ELSE
 12  		  data_type
 13  	      END AS data_type
 14  FROM     user_tab_columns
 15  WHERE    table_name = 'ITEM_LAB'
 16  ORDER BY 2;

                         Column                                                 
Table Name     Column ID Name                   Nullable Data Type              
-------------- --------- ---------------------- -------- ------------           
ITEM_LAB               1 ITEM_LAB_ID            NOT NULL NUMBER(22)             
ITEM_LAB               2 ITEM_LAB_BARCODE       NOT NULL VARCHAR2(14)           
ITEM_LAB               3 ITEM_LAB_TYPE          NOT NULL NUMBER(22)             
ITEM_LAB               4 ITEM_LAB_TITLE         NOT NULL VARCHAR2(60)           
ITEM_LAB               5 ITEM_LAB_SUBTITLE               VARCHAR2(60)           
ITEM_LAB               6 ITEM_LAB_RATING        NOT NULL VARCHAR2(8)            
ITEM_LAB               7 RELEASE_DATE           NOT NULL DATE                   
ITEM_LAB               8 CREATED_BY             NOT NULL NUMBER(22)             
ITEM_LAB               9 CREATION_DATE          NOT NULL DATE                   
ITEM_LAB              10 LAST_UPDATED_BY        NOT NULL NUMBER(22)             
ITEM_LAB              11 LAST_UPDATE_DATE       NOT NULL DATE                   

11 rows selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #3b - [6 points] Insert three new DVD releases into the ITEM table.
SQL> -- ----------------------------------------------------------------------
SQL> --First Item
SQL> INSERT INTO item_lab
  2  ( item_lab_id
  3  , item_lab_barcode
  4  , item_lab_type
  5  , item_lab_title
  6  , item_lab_subtitle
  7  , item_lab_rating
  8  , release_date
  9  , created_by
 10  , creation_date
 11  , last_updated_by
 12  , last_update_date )
 13  VALUES
 14  ( item_lab_s1.nextval
 15  ,'24543-20181'
 16  ,(SELECT	common_lookup_lab_id
 17    FROM	common_lookup_lab
 18    WHERE	common_lookup_lab_context = 'ITEM_LAB'
 19    AND	common_lookup_lab_type = 'DVD_WIDE_SCREEN')
 20  ,'Goku and the prisoner of azkaban'
 21  ,'A Otako movie'
 22  ,'Everyone'
 23  ,(TRUNC(SYSDATE ) - 1)
 24  , 1001
 25  , SYSDATE
 26  , 1001
 27  , SYSDATE);

1 row created.

SQL> 
SQL> --Second Item
SQL> INSERT INTO item_lab
  2  ( item_lab_id
  3  , item_lab_barcode
  4  , item_lab_type
  5  , item_lab_title
  6  , item_lab_subtitle
  7  , item_lab_rating
  8  , release_date
  9  , created_by
 10  , creation_date
 11  , last_updated_by
 12  , last_update_date )
 13  VALUES
 14  ( item_lab_s1.nextval
 15  ,'24543-20182'
 16  ,(SELECT	common_lookup_lab_id
 17    FROM	common_lookup_lab
 18    WHERE	common_lookup_lab_context = 'ITEM_LAB'
 19    AND	common_lookup_lab_type = 'DVD_WIDE_SCREEN')
 20  ,'Infinity War'
 21  ,'The Last Avanger'
 22  ,'PG'
 23  ,(TRUNC(SYSDATE ) - 1)
 24  , 1001
 25  , SYSDATE
 26  , 1001
 27  , SYSDATE);

1 row created.

SQL> 
SQL> --Third Item
SQL> INSERT INTO item_lab
  2  ( item_lab_id
  3  , item_lab_barcode
  4  , item_lab_type
  5  , item_lab_title
  6  , item_lab_subtitle
  7  , item_lab_rating
  8  , release_date
  9  , created_by
 10  , creation_date
 11  , last_updated_by
 12  , last_update_date )
 13  VALUES
 14  ( item_lab_s1.nextval
 15  ,'24543-20183'
 16  ,(SELECT	common_lookup_lab_id
 17    FROM	common_lookup_lab
 18    WHERE	common_lookup_lab_context = 'ITEM_LAB'
 19    AND	common_lookup_lab_type = 'DVD_WIDE_SCREEN')
 20  ,'Upgrade'
 21  ,'No Man, No Machine, More.'
 22  ,'Everyone'
 23  ,(TRUNC(SYSDATE ) - 1)
 24  , 1001
 25  , SYSDATE
 26  , 1001
 27  , SYSDATE);

1 row created.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification Step #3b
SQL> -- ----------------------------------------------------------------------
SQL> SELECT   i.item_lab_title
  2  ,	      SYSDATE AS today
  3  ,	      i.release_date
  4  FROM     item_lab i
  5  WHERE   (SYSDATE - i.release_date) < 31;

Item Title                 TODAY              RELEASE_DATE                      
-------------------------- ------------------ ------------------                
Goku and the prisoner of a 27-JUL-18          26-JUL-18                         
zkaban                                                                          
                                                                                
Infinity War               27-JUL-18          26-JUL-18                         
Upgrade                    27-JUL-18          26-JUL-18                         

3 rows selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #3c - [26 points] Insert a new member_lab account with three contact_labs.
SQL> -- ----------------------------------------------------------------------
SQL> 
SQL> -- First Record Set
SQL> INSERT INTO member_lab
  2  ( member_lab_id
  3  , member_lab_type
  4  , account_number
  5  , credit_card_number
  6  , credit_card_type
  7  , created_by
  8  , creation_date
  9  , last_updated_by
 10  , last_update_date )
 11  VALUES
 12  ( member_lab_s1.nextval			       -- member_lab_id
 13  , NULL					       -- member_lab_type
 14  ,'US00011' 				       -- account_number
 15  ,'6011 0000 0000 0078'			       -- credit_card_number
 16  ,(SELECT	common_lookup_lab_id
 17    FROM	common_lookup_lab
 18    WHERE	common_lookup_lab_context = 'MEMBER_LAB'
 19    AND	common_lookup_lab_type = 'DISCOVER_CARD')  -- credit_card_type
 20  ,(SELECT	system_user_lab_id
 21    FROM	system_user_lab
 22    WHERE	system_user_lab_name = 'SYSADMIN')	   -- created_by
 23  , SYSDATE					       -- creation_date
 24  ,(SELECT	system_user_lab_id
 25    FROM	system_user_lab
 26    WHERE	system_user_lab_name = 'SYSADMIN')	   -- last_updated_by
 27  , SYSDATE					       -- last_update_date
 28  );

1 row created.

SQL> 
SQL> -- ------------------------------------------------------------------
SQL> --  Insert first contact_lab in a group account user.
SQL> -- ------------------------------------------------------------------
SQL> INSERT INTO contact_lab
  2  ( contact_lab_id
  3  , member_lab_id
  4  , contact_lab_type
  5  , first_name
  6  , last_name
  7  , created_by
  8  , creation_date
  9  , last_updated_by
 10  , last_update_date )
 11  VALUES
 12  ( contact_lab_s1.nextval				   -- contact_lab_id
 13  , member_lab_s1.currval				   -- member_lab_id
 14  ,(SELECT	common_lookup_lab_id
 15    FROM	common_lookup_lab
 16    WHERE	common_lookup_lab_context = 'CONTACT_LAB'
 17    AND	common_lookup_lab_type = 'CUSTOMER')	   -- contact_lab_type
 18  ,'Harry'					       -- first_name
 19  ,'Potter'						 -- last_name
 20  ,(SELECT	system_user_lab_id
 21    FROM	system_user_lab
 22    WHERE	system_user_lab_name = 'SYSADMIN')	   -- created_by
 23  , SYSDATE					       -- creation_date
 24  ,(SELECT	system_user_lab_id
 25    FROM	system_user_lab
 26    WHERE	system_user_lab_name = 'SYSADMIN')	   -- last_updated_by
 27  , SYSDATE					       -- last_update_date
 28  );

1 row created.

SQL> 
SQL> INSERT INTO address_lab
  2  ( address_lab_id
  3  , contact_lab_id
  4  , address_lab_type
  5  , city
  6  , state_province
  7  , postal_code
  8  , created_by
  9  , creation_date
 10  , last_updated_by
 11  , last_update_date )
 12  VALUES
 13  ( address_lab_s1.nextval				   -- address_lab_id
 14  , contact_lab_s1.currval				   -- contact_lab_id
 15  ,(SELECT	common_lookup_lab_id
 16    FROM	common_lookup_lab
 17    WHERE	common_lookup_lab_type = 'HOME')	   -- address_lab_type
 18  ,'Provo'					    -- city
 19  ,'Utah'						 -- state_province
 20  ,'84604'					       -- postal_code
 21  ,(SELECT	system_user_id
 22    FROM	system_user
 23    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 24  , SYSDATE					       -- creation_date
 25  ,(SELECT	system_user_id
 26    FROM	system_user
 27    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 28  , SYSDATE					       -- last_update_date
 29  );

1 row created.

SQL> 
SQL> INSERT INTO street_address_lab
  2  ( street_address_lab_id
  3  , address_lab_id
  4  , street_address_lab
  5  , created_by
  6  , creation_date
  7  , last_updated_by
  8  , last_update_date )
  9   VALUES
 10  ( street_address_lab_s1.nextval			   -- street_address_lab_id
 11  , address_lab_s1.currval				   -- address_lab_id
 12  ,'900 E, 300 N'				  -- street_address_lab
 13  ,(SELECT	system_user_id
 14    FROM	system_user
 15    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 16  , SYSDATE					       -- creation_date
 17  ,(SELECT	system_user_id
 18    FROM	system_user
 19    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 20  , SYSDATE					       -- last_update_date
 21  );

1 row created.

SQL> 
SQL> INSERT INTO telephone_lab
  2  ( telephone_lab_id
  3  , contact_lab_id
  4  , address_lab_id
  5  , telephone_lab_type
  6  , country_code
  7  , area_code
  8  , telephone_lab_number
  9  , created_by
 10  , creation_date
 11  , last_updated_by
 12  , last_update_date )
 13   VALUES
 14  ( telephone_lab_s1.nextval 			   -- telephone_lab_id
 15  , address_lab_s1.currval				   -- address_lab_id
 16  , contact_lab_s1.currval				   -- contact_lab_id
 17  ,(SELECT	common_lookup_lab_id
 18    FROM	common_lookup_lab
 19    WHERE	common_lookup_lab_context = 'MULTIPLE'
 20    AND	common_lookup_lab_type = 'HOME')	   -- telephone_lab_type
 21  ,'001'					       -- country_code
 22  ,'801'					       -- area_code
 23  ,'333-3333'				       -- telephone_lab_number
 24  ,(SELECT	system_user_id
 25    FROM	system_user
 26    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 27  , SYSDATE					       -- creation_date
 28  ,(SELECT	system_user_id
 29    FROM	system_user
 30    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 31  , SYSDATE					       -- last_update_date
 32  );

1 row created.

SQL> 
SQL> -- second Record Set
SQL> INSERT INTO contact_lab
  2  ( contact_lab_id
  3  , member_lab_id
  4  , contact_lab_type
  5  , first_name
  6  , last_name
  7  , created_by
  8  , creation_date
  9  , last_updated_by
 10  , last_update_date )
 11  VALUES
 12  ( contact_lab_s1.nextval				   -- contact_lab_id
 13  , member_lab_s1.currval				   -- member_lab_id
 14  ,(SELECT	common_lookup_lab_id
 15    FROM	common_lookup_lab
 16    WHERE	common_lookup_lab_context = 'CONTACT_LAB'
 17    AND	common_lookup_lab_type = 'CUSTOMER')	   -- contact_lab_type
 18  ,'Ginny'					       -- first_name
 19  ,'Potter'						 -- last_name
 20  ,(SELECT	system_user_lab_id
 21    FROM	system_user_lab
 22    WHERE	system_user_lab_name = 'SYSADMIN')	   -- created_by
 23  , SYSDATE					       -- creation_date
 24  ,(SELECT	system_user_lab_id
 25    FROM	system_user_lab
 26    WHERE	system_user_lab_name = 'SYSADMIN')	   -- last_updated_by
 27  , SYSDATE					       -- last_update_date
 28  );

1 row created.

SQL> 
SQL> INSERT INTO address_lab
  2  ( address_lab_id
  3  , contact_lab_id
  4  , address_lab_type
  5  , city
  6  , state_province
  7  , postal_code
  8  , created_by
  9  , creation_date
 10  , last_updated_by
 11  , last_update_date )
 12  VALUES
 13  ( address_lab_s1.nextval				   -- address_lab_id
 14  , contact_lab_s1.currval				   -- contact_lab_id
 15  ,(SELECT	common_lookup_lab_id
 16    FROM	common_lookup_lab
 17    WHERE	common_lookup_lab_type = 'HOME')	   -- address_lab_type
 18  ,'Provo'					    -- city
 19  ,'Utah'						 -- state_province
 20  ,'84604'					       -- postal_code
 21  ,(SELECT	system_user_id
 22    FROM	system_user
 23    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 24  , SYSDATE					       -- creation_date
 25  ,(SELECT	system_user_id
 26    FROM	system_user
 27    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 28  , SYSDATE					       -- last_update_date
 29  );

1 row created.

SQL> 
SQL> INSERT INTO street_address_lab
  2  ( street_address_lab_id
  3  , address_lab_id
  4  , street_address_lab
  5  , created_by
  6  , creation_date
  7  , last_updated_by
  8  , last_update_date )
  9   VALUES
 10  ( street_address_lab_s1.nextval			   -- street_address_lab_id
 11  , address_lab_s1.currval				   -- address_lab_id
 12  ,'900 E, 300 N'				  -- street_address_lab
 13  ,(SELECT	system_user_id
 14    FROM	system_user
 15    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 16  , SYSDATE					       -- creation_date
 17  ,(SELECT	system_user_id
 18    FROM	system_user
 19    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 20  , SYSDATE					       -- last_update_date
 21  );

1 row created.

SQL> 
SQL> INSERT INTO telephone_lab
  2  ( telephone_lab_id
  3  , contact_lab_id
  4  , address_lab_id
  5  , telephone_lab_type
  6  , country_code
  7  , area_code
  8  , telephone_lab_number
  9  , created_by
 10  , creation_date
 11  , last_updated_by
 12  , last_update_date )
 13   VALUES
 14  ( telephone_lab_s1.nextval 			   -- telephone_lab_id
 15  , address_lab_s1.currval				   -- address_lab_id
 16  , contact_lab_s1.currval				   -- contact_lab_id
 17  ,(SELECT	common_lookup_lab_id
 18    FROM	common_lookup_lab
 19    WHERE	common_lookup_lab_context = 'MULTIPLE'
 20    AND	common_lookup_lab_type = 'HOME')	   -- telephone_lab_type
 21  ,'001'					       -- country_code
 22  ,'801'					       -- area_code
 23  ,'333-3333'				       -- telephone_lab_number
 24  ,(SELECT	system_user_id
 25    FROM	system_user
 26    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 27  , SYSDATE					       -- creation_date
 28  ,(SELECT	system_user_id
 29    FROM	system_user
 30    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 31  , SYSDATE					       -- last_update_date
 32  );

1 row created.

SQL> 
SQL> -- Third Record Set
SQL> INSERT INTO contact_lab
  2  ( contact_lab_id
  3  , member_lab_id
  4  , contact_lab_type
  5  , first_name
  6  , middle_name
  7  , last_name
  8  , created_by
  9  , creation_date
 10  , last_updated_by
 11  , last_update_date )
 12  VALUES
 13  ( contact_lab_s1.nextval				   -- contact_lab_id
 14  , member_lab_s1.currval				   -- member_lab_id
 15  ,(SELECT	common_lookup_lab_id
 16    FROM	common_lookup_lab
 17    WHERE	common_lookup_lab_context = 'CONTACT_LAB'
 18    AND	common_lookup_lab_type = 'CUSTOMER')	   -- contact_lab_type
 19  ,'Lily'					      -- first_name
 20  ,'Luna'					      -- middle name
 21  ,'Potter'						 -- last_name
 22  ,(SELECT	system_user_lab_id
 23    FROM	system_user_lab
 24    WHERE	system_user_lab_name = 'SYSADMIN')	   -- created_by
 25  , SYSDATE					       -- creation_date
 26  ,(SELECT	system_user_lab_id
 27    FROM	system_user_lab
 28    WHERE	system_user_lab_name = 'SYSADMIN')	   -- last_updated_by
 29  , SYSDATE					       -- last_update_date
 30  );

1 row created.

SQL> 
SQL> INSERT INTO address_lab
  2  ( address_lab_id
  3  , contact_lab_id
  4  , address_lab_type
  5  , city
  6  , state_province
  7  , postal_code
  8  , created_by
  9  , creation_date
 10  , last_updated_by
 11  , last_update_date )
 12  VALUES
 13  ( address_lab_s1.nextval				   -- address_lab_id
 14  , contact_lab_s1.currval				   -- contact_lab_id
 15  ,(SELECT	common_lookup_lab_id
 16    FROM	common_lookup_lab
 17    WHERE	common_lookup_lab_type = 'HOME')	   -- address_lab_type
 18  ,'Provo'					    -- city
 19  ,'Utah'						 -- state_province
 20  ,'84604'					       -- postal_code
 21  ,(SELECT	system_user_id
 22    FROM	system_user
 23    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 24  , SYSDATE					       -- creation_date
 25  ,(SELECT	system_user_id
 26    FROM	system_user
 27    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 28  , SYSDATE					       -- last_update_date
 29  );

1 row created.

SQL> 
SQL> INSERT INTO street_address_lab
  2  ( street_address_lab_id
  3  , address_lab_id
  4  , street_address_lab
  5  , created_by
  6  , creation_date
  7  , last_updated_by
  8  , last_update_date )
  9   VALUES
 10  ( street_address_lab_s1.nextval			   -- street_address_lab_id
 11  , address_lab_s1.currval				   -- address_lab_id
 12  ,'900 E, 300 N'				  -- street_address_lab
 13  ,(SELECT	system_user_id
 14    FROM	system_user
 15    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 16  , SYSDATE					       -- creation_date
 17  ,(SELECT	system_user_id
 18    FROM	system_user
 19    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 20  , SYSDATE					       -- last_update_date
 21  );

1 row created.

SQL> 
SQL> INSERT INTO telephone_lab
  2  ( telephone_lab_id
  3  , contact_lab_id
  4  , address_lab_id
  5  , telephone_lab_type
  6  , country_code
  7  , area_code
  8  , telephone_lab_number
  9  , created_by
 10  , creation_date
 11  , last_updated_by
 12  , last_update_date )
 13   VALUES
 14  ( telephone_lab_s1.nextval 			   -- telephone_lab_id
 15  , address_lab_s1.currval				   -- address_lab_id
 16  , contact_lab_s1.currval				   -- contact_lab_id
 17  ,(SELECT	common_lookup_lab_id
 18    FROM	common_lookup_lab
 19    WHERE	common_lookup_lab_context = 'MULTIPLE'
 20    AND	common_lookup_lab_type = 'HOME')	   -- telephone_lab_type
 21  ,'001'					       -- country_code
 22  ,'801'					       -- area_code
 23  ,'333-3333'				       -- telephone_lab_number
 24  ,(SELECT	system_user_id
 25    FROM	system_user
 26    WHERE	system_user_name = 'SYSADMIN')	       -- created_by
 27  , SYSDATE					       -- creation_date
 28  ,(SELECT	system_user_id
 29    FROM	system_user
 30    WHERE	system_user_name = 'SYSADMIN')	       -- last_updated_by
 31  , SYSDATE					       -- last_update_date
 32  );

1 row created.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #3c
SQL> -- ----------------------------------------------------------------------
SQL> COLUMN account_number  FORMAT A10	HEADING "Account|Number"
SQL> COLUMN full_name	    FORMAT A16	HEADING "Name|(Last, First MI)"
SQL> COLUMN street_address_lab	FORMAT A14  HEADING "Street Address"
SQL> COLUMN city	    FORMAT A10	HEADING "City"
SQL> COLUMN state	    FORMAT A10	HEADING "State"
SQL> COLUMN postal_code     FORMAT A6	HEADING "Postal|Code"
SQL> SELECT   m.account_number
  2  ,	      c.last_name || ', ' || c.first_name
  3  ||       CASE
  4  		WHEN c.middle_name IS NOT NULL THEN
  5  		  ' ' || c.middle_name || ' '
  6  	      END AS full_name
  7  ,	      sa.street_address_lab
  8  ,	      a.city
  9  ,	      a.state_province AS state
 10  ,	      a.postal_code
 11  FROM     member_lab m INNER JOIN contact_lab c
 12  ON       m.member_lab_id = c.member_lab_id INNER JOIN address_lab a
 13  ON       c.contact_lab_id = a.contact_lab_id INNER JOIN street_address_lab sa
 14  ON       a.address_lab_id = sa.address_lab_id INNER JOIN telephone_lab t
 15  ON       c.contact_lab_id = t.contact_lab_id
 16  WHERE    c.last_name = 'Potter';

Account    Name                                                  Postal         
Number     (Last, First MI) Street Address City       State      Code           
---------- ---------------- -------------- ---------- ---------- ------         
US00011    Potter, Harry    900 E, 300 N   Provo      Utah       84604          
US00011    Potter, Ginny    900 E, 300 N   Provo      Utah       84604          
US00011    Potter, Lily Lun 900 E, 300 N   Provo      Utah       84604          
           a                                                                    
                                                                                

3 rows selected.

SQL> 
SQL> -- ------------------------------------------------------------------
SQL> -- Step #3d - [14 points] Insert two rows into the RENTAL table with a dependent
SQL> -- row for each in the RENTAL_ITEM table; and one row into the RENTAL
SQL> -- table with two dependent rows in the RENTAL_ITEM table.
SQL> -- ------------------------------------------------------------------
SQL> 
SQL> -- First Record Set (Harry Potter)
SQL> INSERT INTO rental_lab
  2  ( rental_lab_id
  3  , customer_id
  4  , check_out_date
  5  , return_date
  6  , created_by
  7  , creation_date
  8  , last_updated_by
  9  , last_update_date )
 10  VALUES
 11  ( rental_lab_s1.nextval
 12  ,(SELECT	contact_lab_id
 13    FROM	contact_lab
 14    WHERE	last_name = 'Potter'
 15    AND	first_name = 'Harry')
 16  , TRUNC(SYSDATE)
 17  , TRUNC(SYSDATE) + 1
 18  , 1001
 19  , SYSDATE
 20  , 1001
 21  , SYSDATE);

1 row created.

SQL> 
SQL> INSERT INTO rental_item_lab
  2  ( rental_item_lab_id
  3  , rental_lab_id
  4  , item_lab_id
  5  , created_by
  6  , creation_date
  7  , last_updated_by
  8  , last_update_date)
  9  VALUES
 10  ( rental_item_lab_s1.nextval
 11  , rental_lab_s1.currval
 12  ,(SELECT	i.item_lab_id
 13    FROM	item_lab i
 14    ,	common_lookup_lab cl
 15    WHERE	i.item_lab_title = 'Star Wars I'
 16    AND	i.item_lab_subtitle = 'Phantom Menace'
 17    AND	i.item_lab_type = cl.common_lookup_lab_id
 18    AND	cl.common_lookup_lab_type = 'DVD_WIDE_SCREEN')
 19  , 1001
 20  , SYSDATE
 21  , 1001
 22  , SYSDATE);

1 row created.

SQL> 
SQL> INSERT INTO rental_item_lab
  2  ( rental_item_lab_id
  3  , rental_lab_id
  4  , item_lab_id
  5  , created_by
  6  , creation_date
  7  , last_updated_by
  8  , last_update_date)
  9  VALUES
 10  ( rental_item_lab_s1.nextval
 11  , rental_lab_s1.currval
 12  ,(SELECT	i.item_lab_id
 13    FROM	item_lab i
 14    ,	common_lookup_lab cl
 15    WHERE	i.item_lab_title = 'Goku and the prisoner of azkaban'
 16    AND	i.item_lab_subtitle = 'A Otako movie'
 17    AND	i.item_lab_type = cl.common_lookup_lab_id
 18    AND	cl.common_lookup_lab_type = 'DVD_WIDE_SCREEN')
 19  , 1001
 20  , SYSDATE
 21  , 1001
 22  , SYSDATE);

1 row created.

SQL> 
SQL> -- Second Record Set ( Ginny Potter )
SQL> INSERT INTO rental_lab
  2  ( rental_lab_id
  3  , customer_id
  4  , check_out_date
  5  , return_date
  6  , created_by
  7  , creation_date
  8  , last_updated_by
  9  , last_update_date )
 10  VALUES
 11  ( rental_lab_s1.nextval
 12  ,(SELECT	contact_lab_id
 13    FROM	contact_lab
 14    WHERE	last_name = 'Potter'
 15    AND	first_name = 'Ginny')
 16  , TRUNC(SYSDATE)
 17  , TRUNC(SYSDATE) + 3
 18  , 1001
 19  , SYSDATE
 20  , 1001
 21  , SYSDATE);

1 row created.

SQL> 
SQL> INSERT INTO rental_item_lab
  2  ( rental_item_lab_id
  3  , rental_lab_id
  4  , item_lab_id
  5  , created_by
  6  , creation_date
  7  , last_updated_by
  8  , last_update_date)
  9  VALUES
 10  ( rental_item_lab_s1.nextval
 11  , rental_lab_s1.currval
 12  ,(SELECT	i.item_lab_id
 13    FROM	item_lab i
 14    ,	common_lookup_lab cl
 15    WHERE	i.item_lab_title = 'Upgrade'
 16    AND	i.item_lab_subtitle = 'No Man, No Machine, More.'
 17    AND	i.item_lab_type = cl.common_lookup_lab_id
 18    AND	cl.common_lookup_lab_type = 'DVD_WIDE_SCREEN')
 19  , 1001
 20  , SYSDATE
 21  , 1001
 22  , SYSDATE);

1 row created.

SQL> 
SQL> -- Third Record Set (Lyly Luna Potter)
SQL> INSERT INTO rental_lab
  2  ( rental_lab_id
  3  , customer_id
  4  , check_out_date
  5  , return_date
  6  , created_by
  7  , creation_date
  8  , last_updated_by
  9  , last_update_date )
 10  VALUES
 11  ( rental_lab_s1.nextval
 12  ,(SELECT	contact_lab_id
 13    FROM	contact_lab
 14    WHERE	last_name = 'Potter'
 15    AND	first_name = 'Lily')
 16  , TRUNC(SYSDATE)
 17  , TRUNC(SYSDATE) + 5
 18  , 1001
 19  , SYSDATE
 20  , 1001
 21  , SYSDATE);

1 row created.

SQL> 
SQL> INSERT INTO rental_item_lab
  2  ( rental_item_lab_id
  3  , rental_lab_id
  4  , item_lab_id
  5  , created_by
  6  , creation_date
  7  , last_updated_by
  8  , last_update_date)
  9  VALUES
 10  ( rental_item_lab_s1.nextval
 11  , rental_lab_s1.currval
 12  ,(SELECT	i.item_lab_id
 13    FROM	item_lab i
 14    ,	common_lookup_lab cl
 15    WHERE	i.item_lab_title = 'Infinity War'
 16    AND	i.item_lab_subtitle = 'The Last Avanger'
 17    AND	i.item_lab_type = cl.common_lookup_lab_id
 18    AND	cl.common_lookup_lab_type = 'DVD_WIDE_SCREEN')
 19  , 1001
 20  , SYSDATE
 21  , 1001
 22  , SYSDATE);

1 row created.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #3d
SQL> -- ----------------------------------------------------------------------
SQL> COLUMN full_name	FORMAT A18
SQL> COLUMN rental_lab_id   FORMAT 9999
SQL> COLUMN rental_lab_days FORMAT A14
SQL> COLUMN rental_labs     FORMAT 9999
SQL> COLUMN item_labs	    FORMAT 9999
SQL> SELECT   c.last_name||', '||c.first_name||' '||c.middle_name AS full_name
  2  ,	      r.rental_lab_id
  3  ,	     (r.return_date - r.check_out_date) || '-DAY RENTAL' AS rental_lab_days
  4  ,	      COUNT(DISTINCT r.rental_lab_id) AS rental_labs
  5  ,	      COUNT(ri.rental_item_lab_id) AS item_labs
  6  FROM     rental_lab r INNER JOIN rental_item_lab ri
  7  ON       r.rental_lab_id = ri.rental_lab_id INNER JOIN contact_lab c
  8  ON       r.customer_id = c.contact_lab_id
  9  WHERE   (SYSDATE - r.check_out_date) < 15
 10  AND      c.last_name = 'Potter'
 11  GROUP BY c.last_name||', '||c.first_name||' '||c.middle_name
 12  ,	      r.rental_lab_id
 13  ,	     (r.return_date - r.check_out_date) || '-DAY RENTAL'
 14  ORDER BY 2;

                     Rental                                                     
                      Table                                                     
                   --------                                                     
                     Rental                                                     
                       ID #                                                     
Name               --------                                                     
(Last, First MI)   Table #1 RENTAL_LAB_DAY RENTAL_LABS ITEM_LABS                
------------------ -------- -------------- ----------- ---------                
Potter, Harry          1006 1-DAY RENTAL             1         2                
Potter, Ginny          1007 3-DAY RENTAL             1         1                
Potter, Lily Luna      1008 5-DAY RENTAL             1         1                

3 rows selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #4 - [32 points] Modify the design of the COMMON_LOOKUP table
SQL> -- and make necessary data changes to support the new design.
SQL> -- ----------------------------------------------------------------------
SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #4a - Drop the COMMON_LOOKUP_N1 and COMMON_LOOKUP_U2 indexes.
SQL> -- ----------------------------------------------------------------------
SQL> DROP INDEX common_lookup_lab_n1;

Index dropped.

SQL> DROP INDEX common_lookup_lab_U2;

Index dropped.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #4a
SQL> -- ----------------------------------------------------------------------
SQL> COLUMN table_name FORMAT A14
SQL> COLUMN index_name FORMAT A20
SQL> SELECT   table_name
  2  ,	      index_name
  3  FROM     user_indexes
  4  WHERE    table_name = 'COMMON_LOOKUP_LAB';

Table Name     Index Name                                                       
-------------- --------------------                                             
COMMON_LOOKUP_ PK_CLOOKUP_LAB_1                                                 
LAB                                                                             
                                                                                

1 row selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #4b - Add three new columns to the COMMON_LOOKUP table.
SQL> -- ----------------------------------------------------------------------
SQL> ALTER TABLE common_lookup_lab
  2  ADD (common_lookup_lab_table     VARCHAR2(30));

Table altered.

SQL> 
SQL> ALTER TABLE common_lookup_lab
  2  ADD (common_lookup_lab_column    VARCHAR2(30));

Table altered.

SQL> 
SQL> ALTER TABLE common_lookup_lab
  2  ADD (common_lookup_lab_code      VARCHAR2(30));

Table altered.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #4b
SQL> -- ----------------------------------------------------------------------
SQL> SET NULL ''
SQL> COLUMN table_name	 FORMAT A14
SQL> COLUMN column_id	 FORMAT 9999
SQL> COLUMN column_name  FORMAT A22
SQL> COLUMN data_type	 FORMAT A12
SQL> SELECT   table_name
  2  ,	      column_id
  3  ,	      column_name
  4  ,	      CASE
  5  		WHEN nullable = 'N' THEN 'NOT NULL'
  6  		ELSE ''
  7  	      END AS nullable
  8  ,	      CASE
  9  		WHEN data_type IN ('CHAR','VARCHAR2','NUMBER') THEN
 10  		  data_type||'('||data_length||')'
 11  		ELSE
 12  		  data_type
 13  	      END AS data_type
 14  FROM     user_tab_columns
 15  WHERE    table_name = 'COMMON_LOOKUP_LAB'
 16  ORDER BY 2;

                         Column                                                 
Table Name     Column ID Name                   Nullable Data Type              
-------------- --------- ---------------------- -------- ------------           
COMMON_LOOKUP_         1 COMMON_LOOKUP_LAB_ID   NOT NULL NUMBER(22)             
LAB                                                                             
                                                                                
COMMON_LOOKUP_         2 COMMON_LOOKUP_LAB_CONT NOT NULL VARCHAR2(30)           
LAB                      EXT                                                    
                                                                                
COMMON_LOOKUP_         3 COMMON_LOOKUP_LAB_TYPE NOT NULL VARCHAR2(30)           
LAB                                                                             
                                                                                
COMMON_LOOKUP_         4 COMMON_LOOKUP_LAB_MEAN NOT NULL VARCHAR2(30)           
LAB                      ING                                                    
                                                                                
COMMON_LOOKUP_         5 CREATED_BY             NOT NULL NUMBER(22)             
LAB                                                                             
                                                                                
COMMON_LOOKUP_         6 CREATION_DATE          NOT NULL DATE                   
LAB                                                                             
                                                                                
COMMON_LOOKUP_         7 LAST_UPDATED_BY        NOT NULL NUMBER(22)             
LAB                                                                             
                                                                                
COMMON_LOOKUP_         8 LAST_UPDATE_DATE       NOT NULL DATE                   
LAB                                                                             
                                                                                
COMMON_LOOKUP_         9 COMMON_LOOKUP_LAB_TABL          VARCHAR2(30)           
LAB                      E                                                      
                                                                                
COMMON_LOOKUP_        10 COMMON_LOOKUP_LAB_COLU          VARCHAR2(30)           
LAB                      MN                                                     
                                                                                
COMMON_LOOKUP_        11 COMMON_LOOKUP_LAB_CODE          VARCHAR2(30)           
LAB                                                                             
                                                                                

11 rows selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #4c - Migrate data and populate (or seed) new columns with existing data
SQL> -- ----------------------------------------------------------------------
SQL> -- Update the COMMON_LOOKUP_TABLE column with the value of the COMMON_LOOKUP_CONTEXT
SQL> -- column when the COMMON_LOOKUP_CONTEXT column’s value isn’t equal to a value of 'MULTIPLE'
SQL> UPDATE   common_lookup_lab
  2  SET      common_lookup_lab_table = common_lookup_lab_context
  3  WHERE    common_lookup_lab_context <> 'MULTIPLE';

18 rows updated.

SQL> 
SQL> -- Update the COMMON_LOOKUP_TABLE column with the value of of 'ADDRESS' when the
SQL> -- COMMON_LOOKUP_CONTEXT column value is equal to 'MULTIPLE'
SQL> UPDATE   common_lookup_lab
  2  SET      common_lookup_lab_table = 'ADDRESS'
  3  WHERE    common_lookup_lab_context = 'MULTIPLE';

2 rows updated.

SQL> 
SQL> -- Create COMMON_LOOKUP_COLUMN column values based on references to existing
SQL> -- data in the COMMON_LOOKUP table
SQL> UPDATE   common_lookup_lab
  2  SET      common_lookup_lab_column = common_lookup_lab_table || '_TYPE'
  3  WHERE    common_lookup_lab_table IN
  4  	       (SELECT table_name
  5  		FROM   user_tables);

20 rows updated.

SQL> 
SQL> UPDATE   common_lookup_lab
  2  SET      common_lookup_lab_column = 'ADDRESS_TYPE'
  3  WHERE    common_lookup_lab_context = 'MULTIPLE';

2 rows updated.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #4c
SQL> -- ----------------------------------------------------------------------
SQL> COLUMN common_lookup_lab_context  FORMAT A14  HEADING "Common|Lookup Context"
SQL> COLUMN common_lookup_lab_table    FORMAT A12  HEADING "Common|Lookup Table"
SQL> COLUMN common_lookup_lab_column   FORMAT A18  HEADING "Common|Lookup Column"
SQL> COLUMN common_lookup_lab_type     FORMAT A18  HEADING "Common|Lookup Type"
SQL> SELECT   common_lookup_lab_context
  2  ,	      common_lookup_lab_table
  3  ,	      common_lookup_lab_column
  4  ,	      common_lookup_lab_type
  5  FROM     common_lookup_lab
  6  WHERE    common_lookup_lab_table IN
  7  	       (SELECT table_name
  8  		FROM   user_tables)
  9  ORDER BY 1, 2, 3;

Common         Common       Common             Common                           
Lookup Context Lookup Table Lookup Column      Lookup Type                      
-------------- ------------ ------------------ ------------------               
CONTACT_LAB    CONTACT_LAB  CONTACT_LAB_TYPE   EMPLOYEE                         
CONTACT_LAB    CONTACT_LAB  CONTACT_LAB_TYPE   CUSTOMER                         
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      DVD_WIDE_SCREEN                  
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      NINTENDO_GAMECUBE                
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      BLU-RAY                          
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      PLAYSTATION2                     
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      DVD_FULL_SCREEN                  
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      XBOX                             
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    VISA_CARD                        
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    MASTER_CARD                      
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    GROUP                            
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    INDIVIDUAL                       
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    DISCOVER_CARD                    
MULTIPLE       ADDRESS      ADDRESS_TYPE       WORK                             
MULTIPLE       ADDRESS      ADDRESS_TYPE       HOME                             
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY INDIVIDUAL                       
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY COST_CENTER                      
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY SYSTEM_GROUP                     
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY DBA                              
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY SYSTEM_ADMIN                     
B              LAB          PE                                                  
                                                                                

20 rows selected.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #4d - Add two new rows to the COMMON_LOOKUP table to support the 'HOME' and
SQL> -- 'WORK' possibilities for the TELEPHONE_TYPE column
SQL> -- ----------------------------------------------------------------------
SQL> -- remove constranint not null of common_lookup_lab_context
SQL> ALTER TABLE common_lookup_lab
  2  DROP CONSTRAINT nn_clookup_lab_1;

Table altered.

SQL> 
SQL> INSERT INTO common_lookup_lab
  2  ( common_lookup_lab_id
  3  , common_lookup_lab_table
  4  , common_lookup_lab_column
  5  , common_lookup_lab_type
  6  , common_lookup_lab_meaning
  7  , created_by
  8  , creation_date
  9  , last_updated_by
 10  , last_update_date )
 11  VALUES
 12  ( common_lookup_lab_s1.nextval    -- common_lookup_lab_id (1002)
 13  ,'TELEPHONE'		       -- common_lookup_lab_table
 14  ,'TELEPHONE_TYPE'		       -- common_lookup_lab_column
 15  ,'HOME'			       -- common_lookup_lab_type
 16  ,'Home'			       -- common_lookup_lab_meaning
 17  , 1			       -- created_by
 18  , SYSDATE			       -- creation_date
 19  , 1			       -- last_updated_by
 20  , SYSDATE			       -- last_update_date
 21  );

1 row created.

SQL> 
SQL> INSERT INTO common_lookup_lab
  2  ( common_lookup_lab_id
  3  , common_lookup_lab_table
  4  , common_lookup_lab_column
  5  , common_lookup_lab_type
  6  , common_lookup_lab_meaning
  7  , created_by
  8  , creation_date
  9  , last_updated_by
 10  , last_update_date )
 11  VALUES
 12  ( common_lookup_lab_s1.nextval    -- common_lookup_lab_id (1002)
 13  ,'TELEPHONE'		       -- common_lookup_lab_table
 14  ,'TELEPHONE_TYPE'		       -- common_lookup_lab_column
 15  ,'WORK'			       -- common_lookup_lab_type
 16  ,'Work'			       -- common_lookup_lab_meaning
 17  , 1			       -- created_by
 18  , SYSDATE			       -- creation_date
 19  , 1			       -- last_updated_by
 20  , SYSDATE			       -- last_update_date
 21  );

1 row created.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #4d
SQL> -- ----------------------------------------------------------------------
SQL> COLUMN common_lookup_lab_context  FORMAT A14  HEADING "Common|Lookup Context"
SQL> COLUMN common_lookup_lab_table    FORMAT A12  HEADING "Common|Lookup Table"
SQL> COLUMN common_lookup_lab_column   FORMAT A18  HEADING "Common|Lookup Column"
SQL> COLUMN common_lookup_lab_type     FORMAT A18  HEADING "Common|Lookup Type"
SQL> SELECT   common_lookup_lab_context
  2  ,	      common_lookup_lab_table
  3  ,	      common_lookup_lab_column
  4  ,	      common_lookup_lab_type
  5  FROM     common_lookup_lab
  6  WHERE    common_lookup_lab_table IN
  7  	       (SELECT table_name
  8  		FROM   user_tables)
  9  ORDER BY 1, 2, 3;

Common         Common       Common             Common                           
Lookup Context Lookup Table Lookup Column      Lookup Type                      
-------------- ------------ ------------------ ------------------               
CONTACT_LAB    CONTACT_LAB  CONTACT_LAB_TYPE   EMPLOYEE                         
CONTACT_LAB    CONTACT_LAB  CONTACT_LAB_TYPE   CUSTOMER                         
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      DVD_WIDE_SCREEN                  
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      NINTENDO_GAMECUBE                
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      PLAYSTATION2                     
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      XBOX                             
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      BLU-RAY                          
ITEM_LAB       ITEM_LAB     ITEM_LAB_TYPE      DVD_FULL_SCREEN                  
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    VISA_CARD                        
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    MASTER_CARD                      
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    DISCOVER_CARD                    
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    GROUP                            
MEMBER_LAB     MEMBER_LAB   MEMBER_LAB_TYPE    INDIVIDUAL                       
MULTIPLE       ADDRESS      ADDRESS_TYPE       WORK                             
MULTIPLE       ADDRESS      ADDRESS_TYPE       HOME                             
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY INDIVIDUAL                       
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY COST_CENTER                      
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY SYSTEM_GROUP                     
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY SYSTEM_ADMIN                     
B              LAB          PE                                                  
                                                                                
SYSTEM_USER_LA SYSTEM_USER_ SYSTEM_USER_LAB_TY DBA                              
B              LAB          PE                                                  
                                                                                
               TELEPHONE    TELEPHONE_TYPE     HOME                             
               TELEPHONE    TELEPHONE_TYPE     WORK                             

22 rows selected.

SQL> 
SQL> SELECT common_lookup_lab_id
  2  FROM   common_lookup_lab
  3  WHERE  common_lookup_lab_table = 'ADDRESS'
  4  AND    common_lookup_lab_type = 'HOME';

COMMON_LOOKUP_LAB_ID                                                            
--------------------                                                            
                1008                                                            

1 row selected.

SQL> 
SQL> SELECT common_lookup_lab_id
  2  FROM   common_lookup_lab
  3  WHERE  common_lookup_lab_table = 'TELEPHONE'
  4  AND    common_lookup_lab_type = 'HOME';

COMMON_LOOKUP_LAB_ID                                                            
--------------------                                                            
                1016                                                            

1 row selected.

SQL> 
SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #4e - At this point, you need to fix the COMMON_LOOKUP table’s structure
SQL> -- ----------------------------------------------------------------------
SQL> ALTER TABLE common_lookup_lab
  2  DROP COLUMN common_lookup_lab_context;

Table altered.

SQL> 
SQL> ALTER TABLE common_lookup_lab
  2  MODIFY common_lookup_lab_table VARCHAR2(30) NOT NULL;

Table altered.

SQL> 
SQL> ALTER TABLE common_lookup_lab
  2  MODIFY common_lookup_lab_column VARCHAR2(30) NOT NULL;

Table altered.

SQL> 
SQL> CREATE UNIQUE INDEX unique_month ON common_lookup_lab (
  2   common_lookup_lab_table,
  3   common_lookup_lab_column,
  4   common_lookup_lab_type
  5  );

Index created.

SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #4e
SQL> -- ----------------------------------------------------------------------
SQL> SET NULL ''
SQL> COLUMN table_name	 FORMAT A14
SQL> COLUMN column_id	 FORMAT 9999
SQL> COLUMN column_name  FORMAT A22
SQL> COLUMN data_type	 FORMAT A12
SQL> SELECT   table_name
  2  ,	      column_id
  3  ,	      column_name
  4  ,	      CASE
  5  		WHEN nullable = 'N' THEN 'NOT NULL'
  6  		ELSE ''
  7  	      END AS nullable
  8  ,	      CASE
  9  		WHEN data_type IN ('CHAR','VARCHAR2','NUMBER') THEN
 10  		  data_type||'('||data_length||')'
 11  		ELSE
 12  		  data_type
 13  	      END AS data_type
 14  FROM     user_tab_columns
 15  WHERE    table_name = 'COMMON_LOOKUP_LAB'
 16  ORDER BY 2;

                         Column                                                 
Table Name     Column ID Name                   Nullable Data Type              
-------------- --------- ---------------------- -------- ------------           
COMMON_LOOKUP_         1 COMMON_LOOKUP_LAB_ID   NOT NULL NUMBER(22)             
LAB                                                                             
                                                                                
COMMON_LOOKUP_         2 COMMON_LOOKUP_LAB_TYPE NOT NULL VARCHAR2(30)           
LAB                                                                             
                                                                                
COMMON_LOOKUP_         3 COMMON_LOOKUP_LAB_MEAN NOT NULL VARCHAR2(30)           
LAB                      ING                                                    
                                                                                
COMMON_LOOKUP_         4 CREATED_BY             NOT NULL NUMBER(22)             
LAB                                                                             
                                                                                
COMMON_LOOKUP_         5 CREATION_DATE          NOT NULL DATE                   
LAB                                                                             
                                                                                
COMMON_LOOKUP_         6 LAST_UPDATED_BY        NOT NULL NUMBER(22)             
LAB                                                                             
                                                                                
COMMON_LOOKUP_         7 LAST_UPDATE_DATE       NOT NULL DATE                   
LAB                                                                             
                                                                                
COMMON_LOOKUP_         8 COMMON_LOOKUP_LAB_TABL NOT NULL VARCHAR2(30)           
LAB                      E                                                      
                                                                                
COMMON_LOOKUP_         9 COMMON_LOOKUP_LAB_COLU NOT NULL VARCHAR2(30)           
LAB                      MN                                                     
                                                                                
COMMON_LOOKUP_        10 COMMON_LOOKUP_LAB_CODE          VARCHAR2(30)           
LAB                                                                             
                                                                                

10 rows selected.

SQL> 
SQL> COLUMN constraint_name   FORMAT A22  HEADING "Constraint Name"
SQL> COLUMN search_condition  FORMAT A36  HEADING "Search Condition"
SQL> COLUMN constraint_type   FORMAT A10  HEADING "Constraint|Type"
SQL> SELECT   uc.constraint_name
  2  ,	      uc.search_condition
  3  ,	      uc.constraint_type
  4  FROM     user_constraints uc INNER JOIN user_cons_columns ucc
  5  ON       uc.table_name = ucc.table_name
  6  AND      uc.constraint_name = ucc.constraint_name
  7  WHERE    uc.table_name = UPPER('common_lookup_lab')
  8  AND      uc.constraint_type IN (UPPER('c'),UPPER('p'))
  9  ORDER BY uc.constraint_type DESC
 10  ,	      uc.constraint_name;

                                                            Constraint          
Constraint Name        Search Condition                     Type                
---------------------- ------------------------------------ ----------          
PK_CLOOKUP_LAB_1                                            P                   
NN_CLOOKUP_LAB_2       "COMMON_LOOKUP_LAB_TYPE" IS NOT NULL C                   
NN_CLOOKUP_LAB_3       "COMMON_LOOKUP_LAB_MEANING" IS NOT N C                   
                       ULL                                                      
                                                                                
NN_CLOOKUP_LAB_4       "CREATED_BY" IS NOT NULL             C                   
NN_CLOOKUP_LAB_5       "CREATION_DATE" IS NOT NULL          C                   
NN_CLOOKUP_LAB_6       "LAST_UPDATED_BY" IS NOT NULL        C                   
NN_CLOOKUP_LAB_7       "LAST_UPDATE_DATE" IS NOT NULL       C                   
SYS_C0021947           "COMMON_LOOKUP_LAB_TABLE" IS NOT NUL C                   
                       L                                                        
                                                                                
SYS_C0021948           "COMMON_LOOKUP_LAB_COLUMN" IS NOT NU C                   
                       LL                                                       
                                                                                

9 rows selected.

SQL> 
SQL> COLUMN sequence_name   FORMAT A22 HEADING "Sequence Name"
SQL> COLUMN column_position FORMAT 999 HEADING "Column|Position"
SQL> COLUMN column_name     FORMAT A22 HEADING "Column|Name"
SQL> SELECT   UI.index_name
  2  ,	      uic.column_position
  3  ,	      uic.column_name
  4  FROM     user_indexes UI INNER JOIN user_ind_columns uic
  5  ON       UI.index_name = uic.index_name
  6  AND      UI.table_name = uic.table_name
  7  WHERE    UI.table_name = UPPER('common_lookup_lab')
  8  ORDER BY UI.index_name
  9  ,	      uic.column_position;

                       Column Column                                            
Index Name           Position Name                                              
-------------------- -------- ----------------------                            
PK_CLOOKUP_LAB_1            1 COMMON_LOOKUP_LAB_ID                              
UNIQUE_MONTH                1 COMMON_LOOKUP_LAB_TABL                            
                              E                                                 
                                                                                
UNIQUE_MONTH                2 COMMON_LOOKUP_LAB_COLU                            
                              MN                                                
                                                                                
UNIQUE_MONTH                3 COMMON_LOOKUP_LAB_TYPE                            

4 rows selected.

SQL> 
SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Step #4f - copy the values of the correct COMMON_LOOKUP_ID column values
SQL> -- (the surrogate primary key column) into the TELEPHONE_TYPE column of the
SQL> -- TELEPHONE table
SQL> -- ----------------------------------------------------------------------
SQL> 
SQL> -- ----------------------------------------------------------------------
SQL> -- Verification on Step #4f
SQL> -- ----------------------------------------------------------------------
SQL> COLUMN common_lookup_lab_table  FORMAT A14 HEADING "Common|Lookup Table"
SQL> COLUMN common_lookup_lab_column FORMAT A14 HEADING "Common|Lookup Column"
SQL> COLUMN common_lookup_lab_type   FORMAT A8	HEADING "Common|Lookup|Type"
SQL> COLUMN count_dependent	 FORMAT 999 HEADING "Count of|Foreign|Keys"
SQL> COLUMN count_lookup	 FORMAT 999 HEADING "Count of|Primary|Keys"
SQL> SELECT   cl.common_lookup_lab_table
  2  ,	      cl.common_lookup_lab_column
  3  ,	      cl.common_lookup_lab_type
  4  ,	      COUNT(a.address_lab_id) AS count_dependent
  5  ,	      COUNT(DISTINCT cl.common_lookup_lab_table) AS count_lookup
  6  FROM     address_lab a RIGHT JOIN common_lookup_lab cl
  7  ON       a.address_lab_type = cl.common_lookup_lab_id
  8  WHERE    cl.common_lookup_lab_table = 'ADDRESS'
  9  AND      cl.common_lookup_lab_column = 'ADDRESS_TYPE'
 10  AND      cl.common_lookup_lab_type IN ('HOME','WORK')
 11  GROUP BY cl.common_lookup_lab_table
 12  ,	      cl.common_lookup_lab_column
 13  ,	      cl.common_lookup_lab_type
 14  UNION
 15  SELECT   cl.common_lookup_lab_table
 16  ,	      cl.common_lookup_lab_column
 17  ,	      cl.common_lookup_lab_type
 18  ,	      COUNT(t.telephone_lab_id) AS count_dependent
 19  ,	      COUNT(DISTINCT cl.common_lookup_lab_table) AS count_lookup
 20  FROM     telephone_lab t RIGHT JOIN common_lookup_lab cl
 21  ON       t.telephone_lab_type = cl.common_lookup_lab_id
 22  WHERE    cl.common_lookup_lab_table = 'TELEPHONE'
 23  AND      cl.common_lookup_lab_column = 'TELEPHONE_TYPE'
 24  AND      cl.common_lookup_lab_type IN ('HOME','WORK')
 25  GROUP BY cl.common_lookup_lab_table
 26  ,	      cl.common_lookup_lab_column
 27  ,	      cl.common_lookup_lab_type;

                              Common   Count of Count of                        
Common         Common         Lookup    Foreign  Primary                        
Lookup Table   Lookup Column  Type         Keys     Keys                        
-------------- -------------- -------- -------- --------                        
ADDRESS        ADDRESS_TYPE   HOME           15        1                        
ADDRESS        ADDRESS_TYPE   WORK            0        1                        
TELEPHONE      TELEPHONE_TYPE HOME            0        1                        
TELEPHONE      TELEPHONE_TYPE WORK            0        1                        

4 rows selected.

SQL> 
SQL> SPOOL OFF
